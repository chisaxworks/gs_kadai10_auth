# ①課題番号-プロダクト名
- 10-ブックマークアプリ(Session・ログイン)

## ②課題内容（どんな作品か）
- これまで制作してきた「契約管理ツール」に以下の機能を加えました
- ユーザ管理関連
  - ログイン・ログアウト機能
  - ユーザ登録機能
  - 退会機能（life_flgを1から0に変更し、ログイン不可とする＋ログアウト機能）
- ユーザに連動した画面表示（AさんにはAさんが登録したものだけ、BさんにはBさんが登録したものだけ表示）
- XSS対策と必須の入力項目の未入力エラーは一通り設定しました
- 登録する一部のサイトでエラー（ニトリ・阪急ビューティー）になったため、OGP画像の取得の記述を一部見直しました（例外処理とcURLを追加）

## ③DEMO
- https://chisaxworks.sakura.ne.jp/gs_kadai10_php4/

## ④作ったアプリケーション用のIDまたはPasswordがある場合
- 【重要】データの登録・削除や、退会作業を試す場合はご自身でユーザ登録してください（メールアドレスは架空で構いません）
- ユーザ１
  - ログインメールアドレス: chisaxworks@gmail.com
  - ログインパスワード: test
  - 画面表示名：倉本 知左子
- ユーザ２
  - ログインメールアドレス: hana.y@gmail.com ※存在するかもですが架空として利用
  - ログインパスワード: test
  - 画面表示名：山田 花子

## ⑤工夫した点・こだわった点
- UX観点でいくつか気をつけました
  - ログイン・ログアウトだけではなく、ユーザ登録や退会も必要だと思うので加えました
  - ユーザ登録後、再度ログインしなくてもそのまま使えるようにしました（main画面でセッションにuseridがない場合は登録時に払い出されたuseridを取得）
  - ログイン中はその人の名前が出るようにしました（逆にログアウト中は出ない）
  - 以下のケースの場合はログイン画面にアラートをhtml上に表記しています。いずれもログイン画面にリダイレクトをする処理を入れていますが、その際にセッションでエラー情報を引き継ぎ、ログイン画面でその情報を表示し、表示後セッションのエラー情報を空白にしています。
    - パスワードが間違っている
    - メールアドレスが間違っている（ユーザテーブルに存在しない）
    - メールアドレスが退会済（life_flgが0の場合は、アラート上はユーザ情報無しと表記しています（実際は論理削除））
    - ログアウトした状態で、メイン画面などログインが必要な画面を直接開いた時は自動でログイン画面に遷移（ログインを求める）
  - ユーザ登録時に、メールアドレスが同じ、かつ、life_flgが1のものがあった場合は登録できないようにして、html上にアラートを表記しました。
  - ファイル数も膨大になったのでファイル名も意味がわかるよう全体的に見直し、CSSについても共通化できる場所は共通化して、それに伴って一部id名・class名の見直しも実施しました

## ⑥難しかった点・次回トライしたいこと(又は機能)
- ログイン機能は学んだことをそのまま作ればいいと思っていましたが、結構考慮することが多く大変だなと感じました
- 例えば以下の点は実装中や動作確認中に気づいたので、機能に反映したポイントです
  - ユーザごとに表示を変更する必要があるのでテーブルの構成見直し必要（テーブルは新しくしました）
  - ログインしているのに、ログイン画面に行くと再ログインになってしまう（のでセッションをみてメイン画面にリダイレクト）
  - 登録してそのままログインした状態（の方がUX的に良いので）にするとuseridが空欄のままデータが登録できてしまう（login処理の方ではなくログイン後のメイン画面の方で対応）
  - ログイン失敗した時や、ログアウト済でログイン画面にリダイレクトされた時のアラート表示が必要（エラーハンドリング系を整理して全体的に反映）
  - 退会したユーザと同じメールアドレスで再度登録した場合、life_flgが0の方を参照してログイン出来ないことが判明したのでログイン時のSQLを修正
- 次回トライしたいこと
  - メールやURLの正規表現はきちんと理解して反映したいと思っています

## ⑦質問・疑問・感想、シェアしたいこと等なんでも
- 個人メモ
  - 退会時にデータ一括削除もしようかと思いましたが、お試しいただく際にごっそり消されると困るので今回は見送りました
  - ここまで来るとphpのファイル数が膨大になったので、表で何をどこまでやったかなどを整理するようにしました（XSS・未入力アラート対応等）。このボリュームなると作りながら直すよりはきちんと設計することが大事になってくるなと感じました。
